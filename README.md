# ふもとっぱらキャンプ場 空き通知・自動予約システム

```text
    ______                          __                                     
   / ____/_  ______ ___  ____  / /_____  ____  ____  ____ __________ _
  / /_  / / / / __ `__ \/ __ \/ __/ __ \/ __ \/ __ \/ __ `/ ___/ __ `/
 / __/ / /_/ / / / / / / /_/ / /_/ /_/ / /_/ / /_/ / /_/ / /  / /_/ / 
/_/    \__,_/_/ /_/ /_/\____/\__/\____/ .___/ .___/\__,_/_/   \__,_/  
                                     /_/   /_/                        
```

ふもとっぱらキャンプ場の予約サイトを定期的にチェックし、希望する条件で空きが出たらLINEで通知、さらに自動で予約を行うこともできるシステムです。

## 特徴
- **予約セット機能:** 「2/14から1泊」のように、具体的な条件を複数登録して監視できます。
- **LINE通知:** 空きが出たらすぐにスマホにお知らせが届きます。予約サイトへのリンク付きですぐに予約可能です。
- **自動予約モード:** 設定をオンにすると、空きが出た瞬間に自動で予約処理を実行します。
    - 到着時刻は「11:00-13:59」で固定されます。
    - 設定された人数（大人・小学生・未就学児）で予約します。
- **詳細ログ機能:** 取得した全日付の空き状況をCSVファイルとして保存します。後から空きの変動を確認できます。
- **Web設定画面:** ブラウザから簡単に予約セットの追加・削除や、最新ログの確認が行えます。
- **自動ログイン:** 初回ログイン後はログイン状態を維持し、スムーズにチェックします。

### スクリーンショット
**カレンダー画面（空きチェック）**
![カレンダー監視](docs/images/calendar_march.png)

**詳細画面（予約情報）**
![予約詳細](docs/images/detail_page.png)

**ポップアップ確認**
![ポップアップ確認](docs/images/popup_check.png)

## 必要なもの
- PC (Mac/Windows/Linux)
- Python 3
- Chromeブラウザ
- LINEアカウント（通知受取用）

## プロジェクト構成
```
Fumotoppara/
├── src/            # Pythonソースコード (monitor.py, login.pyなど)
├── web/            # 設定画面用HTML
├── config/         # 設定ファイル (config.json)
├── logs/           # 実行ログ・スクリーンショット
├── docs/           # ドキュメント・画像
└── chrome_data/    # Chromeのユーザーデータ (自動生成)
```

## セットアップ手順

### 1. 準備
ターミナルを開き、必要なライブラリをインストールします。
```bash
pip install selenium webdriver_manager python-dotenv requests
```

プロジェクトルートに `.env` ファイルを作成し、以下の情報を記入してください。（既に作成済みの場合はそのままでOKです）
```
EMAIL_ADDRESS=あなたのメールアドレス
PASSWORD=あなたのパスワード
LINE_CHANNEL_ACCESS_TOKEN=LINE Messaging APIのアクセストークン
LINE_USER_ID=あなたのユーザーID
```

### 2. 初回ログイン（必須）
最初に一度だけ、以下のコマンドを実行してログイン情報を保存させます。
```bash
python3 src/fumotoppara_login.py
```
※ブラウザが起動し、自動的にログインしてカレンダー画面が表示されれば成功です。

## 使い方

このシステムは「設定画面」と「監視プログラム」の2つで構成されています。
**必ずプロジェクトのルートディレクトリ（Fumotopparaフォルダ）でコマンドを実行してください。**

### A. 設定画面を開く（予約セットの管理・ログ閲覧）
1. 設定画面用のサーバーを起動します。
   ```bash
   python3 src/settings_server.py
   ```
2. ブラウザで [http://localhost:8000](http://localhost:8000) にアクセスします。
3. **予約セットの追加:** 「セット名」「開始日」「泊数」を入力して追加します。
4. **自動予約:** 「自動予約モードを有効にする」にチェックを入れると、空き発見時に自動で予約を行います。人数も正確に入力してください。
5. **ログの確認:** 「最新ログを更新」ボタンを押すと、直近のチェック結果（CSV）が表示されます。

### B. 監視を開始する
1. 新しいターミナルを開きます（設定画面用とは別で開いてください）。
2. 以下のコマンドを実行して、監視をスタートします。
   ```bash
   python3 src/fumotoppara_monitor.py
   ```
3. プログラムが動き出し、定期的に（デフォルトでは10分ごと）空き状況をチェックします。
   * 登録された予約セットの日付が含まれる月を自動的に巡回してチェックします。
4. 条件（泊数・自動予約設定）を満たす空きが見つかると、LINEに通知が届きます。自動予約モードの場合は予約完了通知が届きます。

**停止方法**
ターミナルで `Ctrl + C` キーを押すと停止します。

## 注意事項
- **自動予約について:** 自動予約機能は、誤って意図しない予約をしてしまったり、キャンセル料が発生する期間に予約してしまうリスクがあります。設定内容（特に日付と人数）は十分にご確認ください。7日以内の予約セットには警告が表示されます。
- チェック間隔を短くしすぎると、サイトに負荷をかけたりアクセス制限を受けたりする可能性があります。
- PCがスリープ状態になるとプログラムも止まってしまいます。長時間動かす場合はスリープ設定を確認してください。
